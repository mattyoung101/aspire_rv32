## Emulation
This directory contains the C++ emulator for Aspire. There are two emulators: the Baseline Emulator,
which is an ISA-level model built on top of a slightly modified version of [rv](https://github.com/mnurzia/rv)*; 
and the Verilator emulator, which is a cycle-accurate model of the SystemVerilog RTL generated by Verilator.
The disassembly trace is powered by [riscv-disassembler](https://github.com/michaeljclark/riscv-disassembler).

This is used for verification by differential fuzzing. Instructions are run through the Verilator model, whose
register file is compared against the reference model.

> * The main modification was not throwing a fault on unaligned loads/stores, under the assumption that the
> hardware will natively support this.
> TODO: verify if RISC-V spec **requires** a fault on unaligned loads/stores
> TODO confirm if HW will actually support this or if we have to write a fault handler and support M-mode

### Building and running
First, install the necessary list of dependencies documented in the section "Verification tools" in the main
README.

Build (example in the fish shell):

```
set -x CXX clang  # if you want Clang
set -x CC clang  # if you want Clang
cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Debug  # or Release
cd build
ninja
```

Run by specifying the path to the .bin file you want to simulate (note this is **not** an ELF file, it's the
result of that after objcopy), and the simulation mode. For example:

```
./emulator --mode baseline --program ../../programs/build/coremark.bin --perf yes
```

For more help, you can use `./emulator --help`

### Libraries used
TODO: licences and URLs
- CLI11
- PCG
- rv
- riscv-disas
