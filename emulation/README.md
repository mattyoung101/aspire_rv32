## Emulation
This directory contains the C++ emulation for the processor. There are two emulators: the Baseline Emulator,
which is an ISA-level model built on top of a modified version of [riscv_em](https://github.com/franzflasch/riscv_em); 
and the Verilator emulator, which is a cycle-accurate model of the SystemVerilog RTL generated by Verilator.
The disassembly trace is powered by [riscv-disassembler](https://github.com/michaeljclark/riscv-disassembler).

This is used for verification by differential fuzzing. Instructions are run through the Verilator model, whose
register file is compared against the reference model.

### Building and running
Requires CMake 3.20+, Clang, Ninja, LLD and spdlog which can be installed using your package manager, 
e.g. `yay -S cmake clang ninja lld spdlog`

Build:

```
cmake -B build -G Ninja -DCMAKE_BUILD_TYPE=Debug  # or Release
cd build
ninja
```

Run by specifying the path to the .bin file you want to simulate (note this is not an ELF file, it's the
result of that after objcopy):

```
./baseline_emulator <PATH_TO_BIN>
```

### Licence
Unfortunately, because riscv_em is under the GPL 3.0, the baseline emulator and fuzzer have to be GPL'd as 
well. Please be advised that this limitation applies to **this and only this directory.** The rest of the 
project is still under the main licence. If riscv_em is replaced with another emulator, this can be fixed
as well.
